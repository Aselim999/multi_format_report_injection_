{
  "type": "sql",
  "statements": "USE [MillensysDB]\r\nGO\r\n\r\n/****** Object:  View [dbo].[MiBroker_studyDicom]    Script Date: 2/4/2025 3:46:42 PM ******/\r\nSET ANSI_NULLS ON\r\nGO\r\n\r\nSET QUOTED_IDENTIFIER ON\r\nGO\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n \r\n\r\n\r\n/* Study_Receptionist: accountService modifiedById getname (employee viewname via accountview) in cwl view\r\n Radiologist_Name: AccountServiceProviderName (read in mibroker_study)\r\n placer_order_id and placer_order_id_issuer empty string instead of 0*/\r\nALTER VIEW [dbo].[MiBroker_studyDicom]\r\nAS\r\nSELECT DISTINCT\r\n       dbo.MiBroker_Patients.Pat_Inc_ID,\r\n       dbo.MiBroker_Patients.Pat_prefix,\r\n       dbo.MiBroker_Patients.pat_birth_datetime,\r\n       dbo.MiBroker_Patients.Pat_Name    Pat_Name  ,\r\n       dbo.MiBroker_Patients.Pat_name_english   Pat_name_english ,\r\n\t   dbo.MiBroker_Patients.FamilyName,\r\n\t   dbo.MiBroker_Patients.FamilyNameL,\r\n\t   dbo.MiBroker_Patients.GivenName,\r\n\t   dbo.MiBroker_Patients.GivenNameL,\r\n\t   dbo.MiBroker_Patients.MiddleName,\r\n\t   dbo.MiBroker_Patients.MiddleNameL,\r\n       dbo.MiBroker_Patients.Pat_driverslicense_number,\r\n       dbo.MiBroker_Patients.Pat_SSN,\r\n       dbo.MiBroker_Patients.Pat_marital_status,\r\n       dbo.MiBroker_Patients.Pat_phone_home,\r\n       dbo.MiBroker_Patients.Pat_phone_business,\r\n       dbo.MiBroker_Patients.Pat_sex,\r\n       dbo.MiBroker_Patients.Pat_nationality,\r\n       dbo.MiBroker_Patients.Pat_allergies,\r\n       dbo.MiBroker_Patients.pat_id_issuer,\r\n       dbo.MiBroker_Patients.Pat_address,\r\n       dbo.PatientClass.PatientClassCode  AS patient_class,\r\n       dbo.Visit.VisitNumber              AS visit_number,\r\n       dbo.Visit.VisitID                  AS pat_account_no,\r\n       dbo.Visit.visit_prior_pat_location_pointofcare AS pointofcare,\r\n\t   dbo.AccountService.Weight          AS room,\r\n\t   dbo.AccountService.height          AS bed,\r\n       dbo.Visit.visit_prior_pat_location_facility AS facility,\r\n       dbo.Mibroker_machine.proc_code     AS proc_id,\r\n       dbo.Mibroker_machine.proc_name,\r\n       dbo.Mibroker_machine.proc_name_standard,\r\n       '' Proc_Description,\r\n       dbo.Mibroker_machine.proc_duration,\r\n       '' proc_comment,\r\n       dbo.Mibroker_machine.Proc_Protocol_Meaning,\r\n       dbo.Mibroker_machine.Proc_Code_Schema,\r\n       dbo.Mibroker_machine.Modality_Name,\r\n       dbo.ClinicWorklistView_notIndexed.ReferringPhysicianName AS req_phy_name,\r\n       dbo.referring_physician.ref_phy_code AS req_phy_id,\r\n       dbo.ClinicWorklistView_notIndexed.AccountServiceID AS Study_inc_id,\r\n       dbo.ClinicWorklistView_notIndexed.AccountServiceDescription AS Study_Reason,\r\n       dbo.ClinicWorklistView_notIndexed.AccountUID AS Study_UID,\r\n       dbo.ClinicWorklistView_notIndexed.StatusId AS Status_RIS,\r\n       dbo.ClinicWorklistView_notIndexed.AccountServiceModifiedByName AS Study_Receptionist,\r\n       dbo.ClinicWorklistView_notIndexed.AccountServiceProviderName AS Radiologist_Name,\r\n       dbo.ClinicWorklistView_notIndexed.ApproximateStartDateTime AS Proc_Start,\r\n       dbo.ClinicWorklistView_notIndexed.ApproximateEndDateTime AS Proc_End,\r\n       ''                                 AS placer_order_id,\r\n       ''                                 AS placer_order_id_issuer,\r\n       dbo.ClinicWorklistView_notIndexed.AccountServiceCode AS AccessionNo_Det_Str,\r\n       dbo.ClinicWorklistView_notIndexed.AccountServiceCode AS Study_Inc_ID_Str,\r\n       dbo.Mibroker_machine.group_code,\r\n       dbo.Mibroker_machine.group_name,\r\n       dbo.Mibroker_machine.group_schema,\r\n       dbo.Mibroker_machine.machine_name,\r\n       dbo.Mibroker_machine.ae_title,\r\n       dbo.Mibroker_machine.Machine_Use_WL,\r\n       dbo.Mibroker_machine.Room_Name,\r\n       ''                                 AS rep_Typist,\r\n       ''                                 AS rep_verify_user,\r\n       dbo.MiBroker_Patients.Study_Location,\r\n       dbo.MiBroker_Patients.Use_WL,\r\n       dbo.ClinicWorklistView_notIndexed.StatusId,\r\n       dbo.ClinicWorklistView_notIndexed.BranchId,\r\n       dbo.ClinicWorklistView_notIndexed.BranchName,\r\n       dbo.ClinicWorklistView_notIndexed.PatientCode,\r\n       dbo.Visit.DateTimeOfAdmission      AS admitting_datetime,\r\n       dbo.ClinicWorklistView_notIndexed.PatientCode AS Pat_ID,\r\n       dbo.Visit.VisitID                  AS visit_inc_id,\r\n       dbo.referring_physician.ref_phy_code AS ref_phy_id,\r\n       dbo.referring_physician.ref_phy_fname,\r\n       dbo.referring_physician.ref_phy_mname,\r\n       dbo.referring_physician.ref_phy_lname,\r\n       dbo.referring_physician.ref_phy_name,\r\n       dbo.referring_physician.ref_phy_degree,\r\n       dbo.referring_physician.ref_phy_prefix,\r\n       dbo.MiBroker_Patients.PersonID,\r\n       0                                  AS Pat_Weight,\r\n       0                                  AS Pat_Height,\r\n       dbo.Mibroker_machine.proc_name     AS RP_Description,\r\n       ''                                 AS req_phy_lname,\r\n       ''                                 AS req_phy_mname,\r\n       ''                                 AS req_phy_fname,\r\n       ''                                 AS req_phy_prefix,\r\n       ''                                 AS req_phy_degree,\r\n       dbo.ClinicWorklistView_notIndexed.MPPS_UID\r\nFROM   dbo.MiBroker_Patients\r\n       INNER JOIN dbo.ClinicWorklistView_notIndexed\r\n            ON  dbo.MiBroker_Patients.Pat_Inc_ID = dbo.ClinicWorklistView_notIndexed.PatientId\r\n       LEFT OUTER JOIN dbo.Visit\r\n            ON  dbo.ClinicWorklistView_notIndexed.VisitId = dbo.Visit.VisitID\r\n       LEFT OUTER JOIN dbo.PatientClass\r\n            ON  dbo.Visit.PatientClassID = dbo.PatientClass.PatientClassID\r\n       LEFT OUTER JOIN dbo.Mibroker_machine\r\n            ON  dbo.Mibroker_machine.proc_id = dbo.ClinicWorklistView_notIndexed.ServiceID and Mibroker_machine.machine_id=ClinicWorklistView_notIndexed.ClinicID\r\n       LEFT OUTER JOIN dbo.referring_physician\r\n            ON  dbo.referring_physician.ref_phy_id = dbo.ClinicWorklistView_notIndexed.ReferringPhysicianID\r\n\t   LEFT OUTER JOIN dbo.AccountService\r\n\t\t\tON dbo.ClinicWorklistView_notIndexed.AccountServiceID = dbo.AccountService.AccountServiceID\r\n\r\n\r\n\r\n\r\n\r\nGO\r\n\r\n\r\n",
  "file_id": "dd67d16d-c7b3-40da-b8a7-646db53a150f",
  "filename": "MiBroker_studyDicom-Weight-Height.sql"
}